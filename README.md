# FULL REPORT ON THE [WIKI](https://github.com/d0ntblink/ICS_Vuln_LAB/wiki)
# 1.1	ABOUT<br>
This document is a report concerning our culminating INCS (Industrial Network Cybersecurity) project at BCIT (British Columbia Institute of Technology). In short, our project goal was to create, assess, test, secure, and reassess an IACS (Industrial Automated Control System) network. We have drawn on networking, system administration, cybersecurity, industrial control, and other skills learned throughout the INCS program.<br>
Our project timeline spanned April 26th, 2021, through May 27th, 2021. On May 25th, we showcased our work at the BCIT Campus INCS lab, and on May 27th we gave a PowerPoint presentation via Zoom, which included a Q&A period.<br>
To keep on track, we first created a proposal document which was submitted on May 6th. This proposal outlined how our team planned to approach the project and included a WBS (Work Breakdown Structure) and Project Schedule Network Diagram. At this time, we also assigned tasks to team members based on individual strengths and preferences.<br>
From the beginning, we tried to be cognizant of the potential challenges we would face. The first of these stemmed from working remotely, due to COVID-19 restrictions. Because of this, we knew we would have to keep our simulated IACS networks well-managed and within the resource confines of our personal computers (mainly with regard to system memory). We decided that we would tackle the collaborative remote work by using text and voice communication applications such as Discord, and document editing tools such as Google Docs and Microsoft Word.<br><br>
# 1.2	SCOPE<br>
Our project encompassed creating a simple simulated IACS (Industrial Automated Control System) network for the purpose of demonstrating control system vulnerabilities. We conducted a risk assessment following ISA/IEC 62443 guidelines, hardened devices, and redesigned zones and conduits to improve the security of the network. We also added security appliances to the redesigned network, including firewalls, a SIEM (Security Information and Event Management) system, and a honeypot. Our deliverables include a live demo, this formal technical report, and a presentation containing our project outcomes and findings.<br>
1.3	ORIGINAL NETWORK DESIGN<br>
The original network design we decided on was inspired by Pascal Ackerman’s IACS (Industrial Automated Control System) in his book titled Industrial Cybersecurity) [1]. We took the basic layout of the network, which consists of three zones (Public Network, Business Network, and ICS Network) and simplified it by removing redundant equipment. Part of our goal here was to reduce the network to something we could each feasibly run on our home systems. We chose to build our virtual network using VMware Workstation, and the resulting network (below) consumed approximately 8 GB of RAM with everything up and running.<br>
![Original IACS Network Design](https://github.com/d0ntblink/ICS_Vuln_LAB/blob/master/Pictures/firstnet.png)<br>
Figure 1 Original IACS Network Design<br>
This network represents the core components found in a traditional control system environment. We have our OT (Operational Technology) network, our IT (Information Technology) network, and we have the Public Internet. Our plant devices all reside behind a firewall, whose default configuration is to block outside traffic from entering the network, while allowing both our Business and Engineering Workstations to access the Internet. The simulated Modbus TCP Server represents our plant’s physical process control.<br><br>
# 1.4	PENETRATION TEST<br>
Following Lockheed Martin’s Cyber Kill Chain [2], we conducted a penetration test of our original IACS (Industrial Automated Control System) network. The Cyber Kill Chain outlines a 7-stage model that can be applied to cyberattacks.<br>
Stage 1 is Reconnaissance, where information is gathered about the target, and is where the attacker’s plan for entry is formed. In our test, we assumed to have found an employee who conducted business with TD Bank and had been trying to reach out to them for support.<br>
In stage 2, Weaponization, we created a TD Bank phishing website for our victim to visit that hosted a malicious payload. When the victim accessed the website and downloaded the executable, their computer connected to our attack machine and established a remote connection.<br>
Stage 3 – Delivery. This step involved setting up a means to get the victim to the phishing site and convincing them to download the malware.<br>
Stages 4 and 5 are Exploitation and Installation, respectively. Once our victim downloaded and ran the malware, our attack machine had access to the internal IACS network, effectively bypassing the firewall. In our test, we used a reverse TCP shell exploit coupled with Meterpreter, which is part of the Metasploit Framework in Kali Linux.<br>
Command and Control is the 6th stage of the Kill Chain. At this point we had access to a machine in the internal network and were able to escalate our privileges to gain full control of the system. Through Meterpreter commands and Metasploit tools we were able to access the firewall configuration webpage and add an exception for RDP (Remote Desktop Protocol). This would allow us to connect to and control the machine as if we were sitting in front of it with a graphical user interface. Before connecting, however, we first needed to obtain the password for the RDP connection. This was done by executing a ‘hash dump’, which reveals an encrypted version of the system password. After cracking the hashed password, we were able to control the victim’s machine through RDP.<br>
The final stage is 7 – Actions and Objections. Now that we had full access to the victim’s machine on the inside network with RDP, we could do just about anything on that machine as if we were physically there. Since the machine we accessed was the Engineering Workstation, that included taking control over the physical plant equipment via the Modbus TCP server.<br>
If we had gained access to the Main Workstation instead, we would still be able to achieve the same end result, it would just require pivoting from one system to another in our attack.<br><br>
# 1.5	NETWORK ASSESSMENT<br>
To conduct a proper network assessment, we had to consider things such as asset identification, zones and conduits, and foundational requirements. From there we could identify vulnerabilities in our network and start to create SL-Ts (Target Security Levels) for each zone. This process was based on the ISA/IEC 62443 set of guidelines.<br>
## 1.5.1	Identifying Assets<br>
The first step was to identify assets in the network. There were three asset categories we identified in our control network: Hardware and Devices, Software, and Protocols.<br>
Hardware assets include devices such as our computer workstations and the Modbus TCP server. Software assets include our Windows operating systems, industrial control software, web browsers, etc. For protocol assets we identified Modbus TCP, HTTP and HTTPS (web traffic), ICMP (device connectivity testing), and others.<br>
## 1.5.2	Zones and Conduits<br>
By conducting a SUC (System Under Consideration) analysis, we identified our current zones as the IT Network, the OT Network, and the Public Internet. The Public Internet was out of our control, so we ignored that zone.<br>
As it stood, our communication conduits were identifiable as the connections between devices/divisions separating zones. For example, from the Modbus TCP server to the Engineering Workstation was one conduit, and the Engineering Workstation to the Business Workstation and Firewall was another.<br>
The goal here was to improve network segmentation, as breaking up the network into more stratified zones would help us achieve better security later on. We did this by creating new zones which in turn created new communication conduits.<br>
Our new zones included the Enterprise Zone, the Industrial Zone, the IDMZ (Industrial Demilitarized Zone), and the Bridge Network. Communication between the Enterprise Zone and the Public Internet (WAN) had not changed with these additions, but direct communication between the Enterprise and Industrial zones had now been severed by adding an IDMZ. The IDMZ segmented traffic and allowed us to more easily monitor and also block potentially malicious traffic from traversing between the network zones.<br>
## 1.5.3	Foundational Requirements<br>
Foundational Requirements (FRs) are outlined in the ISA/IEC 62443 specifications and exist in 7 categories defined as FR1 through FR7. In summary, these FRs deal with topics such as user identification, access control and limiting, system and data confidentiality and integrity, data flow restrictions, timely event response, and resource availability. We covered in detail how each of these FRs are met in our improved network design in the details section of this report. A brief outline of what steps we took to achieve these FRs can be found in the Countermeasures section below.<br>
## 1.5.4	Target Security Levels<br>
Target Security Levels (SL-Ts) range from 1 through 4. Security Levels are defined based on ease of violation and probable threat actor (Figure 2). We assigned SL-T values to each of our three zones based on their capabilities and assessed security requirements.<br>
![Security Levels](https://github.com/d0ntblink/ICS_Vuln_LAB/blob/master/Pictures/security_levels.png)<br>
Figure 2 Security Levels [3]<br>
For the Enterprise Network, we assigned SL1 with the goal of improving to SL2, as this zone could accept a fair amount of risk.
The Industrial Zone was our main focus in this network, so our goal for it was SL2, with the expectation of moving to SL3 in the near future.
The IDMZ was another important zone that separated and protected the other two zones from each other. We assigned this zone a target of SL2, again with the expectation of improving to SL3.<br>
## 1.5.5	Countermeasures<br>
Working toward a redesign of our original network involved choosing appropriate countermeasures to install in the network. These countermeasures had to address vulnerabilities identified previously in our network zones.<br>
Adding a Windows Server 2019 Domain Controller to the network allowed us to manage user accounts with more granularity, and enabled creation of user groups with access permissions matching job requirements. This made it easier to assign standard user accounts with fewer privileges and revoke access to accounts that were no longer needed. Group Policy settings also made managing the workstations simpler and less error prone.
We chose to add a Security Onion system as our SIEM (Security Information and Event Management) device. Security Onion is an open-source threat hunting and security monitoring solution that includes log management [4]. By installing this appliance in our network, we were able to inspect and analyze traffic from all LAN (Local Area Network) segments by utilizing sniffing interfaces. Security Onion also allowed us to run compatible packages on the rest of our systems which provided additional intrusion detection and reporting capabilities.<br>
We also added a honeypot to our network called Conpot. Honeypots are used to lure attackers into a controlled environment and away from critical devices by presenting themselves as something they are not. In this case, Conpot masqueraded as a system running many common industrial protocols [5].<br>
Another pfSense firewall was also added to our network to divide the Industrial and IDMZ zones. This firewall had a much stricter ruleset compared to the first gateway firewall.<br><br>
# 1.6	IMPROVED NETWORK DESIGN<br>
In our improved network design, we built upon the original by adding better zone segmentation and hardware countermeasures (Figure 3). For zones, we took cues from our assessment and set up an IDMZ (Industrial Demilitarized Zone) to separate the Enterprise and Industrial zones. We also added a Bridge Network to connect the two pfSense firewalls in the network.<br>
By using this design, we were able to set granular controls over zone communication. For example, communication to the Industrial Zone was now blocked by default, but we still allowed Industrial devices to report back to certain IDMZ devices (Domain Controller & Security Onion). This was possible because we used stateful firewalls, which track outgoing connection requests and allow matching reply traffic back in.
In general, our firewall rulesets were tightened as well. We now made use of a ‘deny by default’ policy, which meant that unless a type of traffic was explicitly allowed in our firewall ruleset, it was blocked.<br>
![Improved Network Design](https://github.com/d0ntblink/ICS_Vuln_LAB/blob/master/Pictures/iacsnet_nosl.png)<br>
Figure 3 Improved Network Design<br>
We upgraded our Windows 7 workstations to Windows 10 and joined them to a domain, with many security settings now managed by Group Policy.
Also present in our new design were the countermeasures outlined in our network assessment. A Windows Server 2019 Domain Controller was installed, as well as a Security Onion SIEM (Security Information and Event Management) system and a honeypot (Conpot). These devices not only increased our security capabilities, but also gave us a detailed view of what was going on in our network.<br>
This redesigned network was built in VMware, although system memory requirements were significantly higher than our original network. Running all the systems at on a single host computer utilized 27 GB of RAM. For more information on setting up this or the original virtual network, refer to the Appendix, which contains our network setup and configuration document.<br><br>
# 1.7	LESSONS LEARNED<br>
During the planning phase of our project and before submitting our proposal document, we created a WBS (Work Breakdown Structure) and Project Schedule Network Diagram. These enabled us to break our project down into tasks and subtasks, which could be tracked and managed on a projected timeline. While working on the project itself, we ran into a few technical setbacks, such as getting VMware’s virtual networks and adapters configured properly and setting up Security Onion’s monitoring and agent reporting capabilities. These caused delays in meeting some of our target deadlines, and we had to make up time by working on multiple tasks simultaneously and adjusting some expectations.<br><br>
# 1.8	CONCLUSION<br>
There are many things to consider when building or rebuilding an industrial control network that affect not only security, but useability. We found that a good approach was to look at securing the network in stages, and the ISA/IEC 62443 guidelines provided an excellent set of materials to work from for this.
## 1.8.1	Outcomes<br>
In our report, we showed how a basic IACS network could be comprised, and how this could affect not only a company’s IT (Information Technology) assets, but also their OT (Operational Technology) assets and the physical plant process. An attack that can impact the process level has the potential to be costly not only monetarily, but also with regard to safety.<br>
We found that increasing network and system visibility played a large part in enabling security personnel to respond quickly to potential breaches. If technical security is high, but no monitoring or traffic inspection capability exists in the network, the SOC (Security Operations Center) team will have no idea of an attack until it is too late. By adding devices with monitoring and alerting capabilities (such as Security Onion SIEM), security personnel can be alerted of abnormalities before it is too late.<br>
We improved on our original design by adding zones to increase network segmentation and updating workstations and joining them to a domain for easier management. Security Onion and an IACS specific honeypot were also installed in the network with reporting dashboards visible on a new dedicated monitoring workstation. Finally, we created a robust set of firewall rules based on ‘deny-by-default’ principles to manage the flow of traffic in the network.<br>
## 1.8.2	Next Time<br>
Due to COVID-19 we had to conduct most of our work remotely and on our personal computers. This introduced additional restrictions on what we could feasibly set up for our virtual networks. If we were able to use the BCIT (British Columbia Institute of Technology) INCS (Industrial Network Cybersecurity) lab full-time, we would not have had to worry as much about system hardware constraints and trying to get reliable VPN (Virtual Private Network) connectivity between our computers working for the purpose of splitting the network.<br>
The timeline for the project was also quite compressed, as we had just shy of 5 weeks from the start of the course to the final report submission and presentation deadlines. The original schedule we created for the WBS (Work Breakdown Structure) and Project Schedule Network Diagram had our projected end-date set for mid-June – about 20 days longer than we could afford. Realizing this, we adjusted our task end-dates and tried to fit everything in a shorter timeline. It was not easy, but our team really pulled together, and we leveraged each other’s strengths to finish the tasks on time.<br>
In the future, we would recommend more time for a project of this nature; or a reduction in scope, given the timeline. Potentially another way to address this would be to increase the size of the groups slightly (i.e.: 4 vs 3 or 2), as the workload would be more manageable this way.<br>
